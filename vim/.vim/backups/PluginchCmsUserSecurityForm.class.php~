<?php
class PluginchCmsUserSecurityForm extends chCmsFormManagerForm
{
  public function setup()
  {
    parent::setup();
    $this->widgetSchema->setNameFormat('my_security[%s]');
    $forms = chTools::get('guard_extra_security_forms', array(
            'password' => array(
              'class' =>'chCmsUserChangePasswordForm', 
              'label' => 'password', 
              'model' => 'sfGuardUser', 
              'field_name' => 'id'
          )));
    foreach ($forms as $key => $config)
    {
      $config['scope'] = array_key_exists('scope', $config) ? $config['scope'] : array();
      if (array_key_exists('field', $config['scope']))
      {
        $config['scope'] = array($config['scope']);
      }
      $config['scope'][] = array(
              'field' => array_key_exists('field_name', $config) ? chTools::camelize($config['field_name']) : 'userId', 
              'value' => sfContext::getInstance()->getUser()->getGuardUser()->getId());
      $this->addForm($key, $config);
    }
  }
}
