#!/bin/bash
###########################
# include dependancies
##########################
SCRIPTPATH=`readlink -f $0`;DIR=`dirname $SCRIPTPATH`;
. "$DIR/../lib/admin.sh.inc"
CHA_BASEDIR=`cha_basedir $0`

TRUE=1
FALSE=0

DESTPATH="$1"
#if no $1 check ch-admin.config
if [ -z "$DESTPATH" ] ; then
  DESTPATH="$TRESA_DEPENDENCIES_REPOS_PATH"
fi

#if no ch-admin.config info  check actual path
if [ -z "$DESTPATH" ] ; then
  # set the path to current path
  DESTPATH=`dirname $CHA_BASEDIR`
fi
#error
if [ -z "$DESTPATH" ] ; then
  cha_error 'ERROR! please define TRESA_DEPENDENCIES_REPOS_PATH in ch-admin.config or $1 .' $ERROR_ARG_REQUIRED
fi

cha_add_config_value "TRESA_DEPENDENCIES_REPOS_PATH" $DESTPATH

###########################
#generic fonction to clone/pull:
#PARAM $1 is the url of repo 
#PARAM $2 the name of dependance (and the directory for local repository )
#PARAM $3 if a gh-pages branch need to be create (cf github) boolean 
##########################
execute_install_script () {
  if [ -z $1 -o -z $2 ] ; then 
    cha_error "Two arguments required!" $ERROR_ARG_REQUIRED
  fi
  REPO=$1
  DIR=$2
  if [ -d "$DESTPATH/$DIR" -a -d "$DESTPATH/$DIR/.git" ] ; then
    
    cha_info "pull from $REPO into $DESTPATH/$DIR"

    cd "$DESTPATH/$DIR"
    git pull 

  else
    
    # user infoation
    cha_info "clone from $REPO into $DESTPATH/$DIR'"

    #if directory not exist
    if [ ! -d  "$DESTPATH/$DIR" ]; then
      mkdir "$DESTPATH/$DIR"
      cha_info "Create directory $DIR"
    fi
    
    cha_info "Clone repository $DIR"
    git clone $REPO "$DESTPATH/$DIR"
    cha_info "Repository $DIR cloned!"
    cd "$DESTPATH/$DIR"
    if [ $3 -eq $TRUE ] ; then
      git checkout -b gh-pages origin/gh-pages
      git checkout master
    fi
  fi
  
 cd $DESTPATH
}
###########################
#DEPENDENCIES INSTALLATION
##########################
cha_confirm "Do you want to clone all the dependences in $DESTPATH?"

#for jquery-week-calendar

REPO_PATH="git@github.com:themouette/jquery-week-calendar.git"
DEST_DIRECTORY="jquery-week-calendar"
execute_install_script $REPO_PATH $DEST_DIRECTORY $TRUE

#for uniform 
REPO_PATH="git@github.com:pixelmatrix/uniform.git"
DEST_DIRECTORY="uniform"
execute_install_script $REPO_PATH $DEST_DIRECTORY $FALSE

#for qtip2
REPO_PATH="git@github.com:Craga89/qTip2.git"
DEST_DIRECTORY="qtip2"
execute_install_script $REPO_PATH $DEST_DIRECTORY $FALSE

#for aristo
REPO_PATH="https://github.com/taitems/Aristo-jQuery-UI-Theme.git"
DEST_DIRECTORY="aristo"
execute_install_script $REPO_PATH $DEST_DIRECTORY $FALSE
