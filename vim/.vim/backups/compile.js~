var path = require('path'),
    sys = require('sys'),
    fs = require('fs');

require.paths.unshift('/home/ludovic/.nave/node_modules/');

var less = require('less');

var theme_def = {
    'text-color'                : '#000',

    /*menu bar*/
    'menu_bar'                  : '#E0E0E0',
    'menu_bar_button_hover'     : '#eeeeee',
    'menu_bar_button_hover_text': '#000000',
    'menu_bar_text'             : '#000000',

    /*menu*/
    'menu_button'               : '#eeeeee',
    'menu_button_selected'      : '#8897ba',
    'menu_button_hover'         : '#cccccc',

    /*accordion*/
    'accordion_background'      : '#dfe3ea',
    'accordion_header'          : '#dddddd',
    'accordion_header_selected' : '#dddddd',
    'accordion_group_background': '#FAD163',
    'accordion_item'            : 'transparent',
    'accordion_item_hover'      : '#f0f0f0',
    'accordion_item_selected'   : '#DFE0EA',
    'accordion_item_text'       : '#000000',

    /*title bar*/
    'title_bar'                 : '#DFE0EA',
    'title_bar_text'            : '#000000'
  };

var themes = {
    'ui-lightness': {
      },
    'ui-darkness':  {
      'text-color'                : '#000',

      /*menu bar*/
      'menu_bar'                  : '#444444',
      'menu_bar_button_hover'     : '#0086F5',
      'menu_bar_button_hover_text': '#000000',
      'menu_bar_text'             : '#ffffff',

      /*menu*/
      'menu_button'               : '#eeeeee',
      'menu_button_selected'      : '#0086f5',
      'menu_button_hover'         : '#cccccc',

      /*accordion*/
      'accordion_background'      : '#333333',
      'accordion_header'          : '#dddddd',
      'accordion_header_selected' : '#0086F5',
      'accordion_group_background': '#777777',
      'accordion_item'            : 'transparent',
      'accordion_item_hover'      : '#f0f0f0',
      'accordion_item_selected'   : '#00a6f5',
      'accordion_item__hover_text': '#000000',

      /*title bar*/
      'title_bar'                 : '#444444',
      'title_bar_text'            : '#ffffff'
      },
    'smoothness':   {
      },
    'aristo':       {
      },
    'start':        {
      'text-color'                : '#000',

      /*menu bar*/
      'menu_bar'                  : '#00c1ff',
      'menu_bar_button_hover'     : '#ACDD4A',
      'menu_bar_button_hover_text': '#000000',
      'menu_bar_text'             : '#ffffff',

      /*menu*/
      'menu_button'               : '#eeeeee',
      'menu_button_selected'      : '#0086f5',
      'menu_button_hover'         : '#ACDD4A',

      /*accordion*/
      'accordion_background'      : '#00c1ff',
      'accordion_header'          : '#dddddd',
      'accordion_header_selected' : '#69c9c1',
      'accordion_group_background': '#ACDD4A',
      'accordion_item'            : 'transparent',
      'accordion_item_hover'      : '#00a8ff',
      'accordion_item_selected'   : '#00a7ff',
      'accordion_item__hover_text': '#000000',

      /*title bar*/
      'title_bar'                 : '#00c1ff',
      'title_bar_text'            : '#ffffff'
      }
  };

var input = path.join(__dirname, 'style.less');

for (var theme in themes) {
  var data = '',
      output = path.join(__dirname, '..', theme, 'menu.css');

  for (var prop in theme_def) {
    if (!themes[theme][prop]) {
      themes[theme][prop] = theme_def[prop];
    }
  }

  for (var prop in themes[theme]) {
    data += '\n@' + prop + ': '+ themes[theme][prop] +';'
  }

  data += '@import "menu.less";';

  var parser = new(less.Parser)({
      paths: [__dirname], // Specify search paths for @import directives
      filename: input // Specify a filename, for better error messages
    });

  var getCb = function(output) {
    return function (e, tree) {
      if (e) {
          sys.puts("compile css: " + e.message);
          process.exit(1);
      }

      var css = tree.toCSS({ compress: false }); // Minify CSS output
      fd = fs.openSync(output, "w");
      fs.writeSync(fd, css, 0, "utf8");
    };
  };

  parser.parse(data, getCb(output));
}
// vim:ft=javascript
