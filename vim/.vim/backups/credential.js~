(function($, undefined){

  // compile regex
  var _rCredName = /\[(\w+)\]$/i;

  // retrieve credential name for input checkbox
  function find_credential_name ($input) {
    var matches = _rCredName.exec($input.attr('name'));
    return matches[1] || null;
  }

  function toggle_defaults($defaultInput) {
      var _checked = $defaultInput.is(':checked'),
          _Credential = find_credential_name($defaultInput);

      // find all checkboxes with same credential
      $(':checkbox[name*="\[' + _Credential + '\]"]')
          .not($defaultInput)
          .each(function(){
              // disable and check
              if (_checked) {
                  $(this)
                    .attr('disabled', true)
                    .parent(/* 'span' */).addClass('checked')
                    .parent(/* 'div' */).addClass('disabled');
                }
              else {
                  // restore default values
                  $(this)
                    .attr('disabled', false)
                    .parent(/* 'span' */).parent(/* 'div' */).removeClass('disabled');
                  if (!$(this).is(':checked')) {
                    $(this).parent('span').removeClass('checked');
                  }
              }
          });
  }

  // foreach default, on change and onload :)
  $(function() {
    $('#contractor-rights-form')
    .submit(function() {$(this).find(':checkbox[disabled]').attr('disabled', true)})
    .find(':checkbox.default_right_selector')
      .each(function() {
        toggle_defaults($(this));
      })
      .live('change', function(e) {
        toggle_defaults($(this));
      });
  })
})(jQuery);
