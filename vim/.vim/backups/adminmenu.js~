(function($, undefined){

	function getParent($panel){
		//case there is a layout
		var $parent = $panel.parents('.ui-layout-pane-center').eq(0);
		//otherwise
		if (!$parent) {
			$parent = $panel.parent();
		}
		return $parent;
	}

	function resizeAdminPanel($panel){
		$panel.height(getParent($panel).height());
	}

	$(function(){
		//menubar scripts
		$('.chcms-menubar div.menu-button.list')
			.removeClass('list')
			.width(function(_i, _width){return _width})
			.bind('mouseenter mouseleave', function(event){
				if('mouseenter' === event.type){
					$(this).addClass('list-hover');
				}
				else{
					$(this).removeClass('list-hover');
				}
			})
			.children('a')
				.bind('click touchstart', function(){
					$(this)
						.parent()
						.toggleClass('list-hover')
						.parents('.ui-layout-pane')
							.css({'overflow': 'visible', 'z-index':3});
					return false;
				});

		// admin panel scripts
		var $panel = $('.admin-panel'),
		    $centerPanel = $panel.find('.admin-content');

		//initializes the admin panel (left menu, center panel)
		if($panel.length)
		{
			$panel
				.height(getParent($panel).height())
				.layout({
					west:{
						spacing_open: 2,
            size: 280,
						paneSelector: '.chcms-sidebar',
						closable:     false,
						slidable:     false,
						onresize_end: function(){
								$(window).trigger("resize.left.admin");
							}
						},
					center:{
						paneSelector: '.admin-content',
						onresize_end: function(){
								$(window).trigger("resize.center.admin");
							}
						}
				});

			// bind the resize when needed
			$(window).bind("resize.center", function(){resizeAdminPanel($panel)});

			var $header = $('.admin-title', $centerPanel);
			if ($header.length) {
				$header.appendTo($('.ui-layout-north', $centerPanel));
			}
			var $footer = $('.admin-footer:not(form .admin-footer)', $centerPanel);
			if($footer.length){
				$footer.appendTo($centerPanel);
			}
			// initializes the admin panel center layout
			$centerPanel
					.height(getParent($centerPanel).height())
					.layout({
						north:{
							spacing_open: 0,
							closable:     false,
							slidable:     false
							},
						south:{
							paneSelector: '.admin-footer:not(form .admin-footer)',
							spacing_open: 0,
							closable:     false,
							slidable:     false
							},
						center:{
							}})
			// bind the resize when admin panel is resized
			$(window).bind("resize.center.left", function(){resizeAdminPanel($centerPanel)});
		}

    // if in accordion menu type
    $('.chcms-menu-accordion .chcms-group-accordion .chcms-group-accordion-header').click(function(e){
        var $group = $(this).parents('.chcms-group-accordion');
        if (!$group.hasClass('selected')) {
            $group.siblings()/*.not(':has(.selected)')*/.removeClass('selected');
            $group.addClass('selected');
          }
        e.preventDefault();
      });
	})
})(jQuery);
