# Company demo 1
# =======================
# 
# Introduction
# ------------
#
# describes scenario for "demo 1"
#
# calendars
# ---------
#
# In this scenario, Demo, Collaborator demo, Ressource 2 and Ressource 2
# have a calendar each.
#
# Only Julien and Pierre can access Luc calendar
# everybody can access Bob calendar
#
# Only Morgane and Luc can access Morgane calendar
# Only Luc and Morgane can access Luc calendar
#
# Julien and Bob publish their calendars
# Morgane and Luc publish their calendars for clients only
#
#
# contacts
# --------
# 
# everything else has to be defined
#
# To sum up
# ---------
# 
# ### calendar visibility
#
# | contractor          | Entity    | Calendar  | Result    |
# | demo                | PARENT    | PARENT    | PROTECTED |
# | collaborateur demo  | COMPANY   | PARENT    | PROTECTED |
# | ressource 1         | PARENT    | PARENT    | PROTECTED |
# | ressource 1         | PARENT    | PARENT    | PROTECTED |
#
# ### calendar publication
#
# | contractor          | Entity    | Calendar  | Result    |
# | demo                | PARENT    | PARENT    | PROTECTED |
# | collaborateur demo  | COMPANY   | PARENT    | PROTECTED |
# | ressource 1         | PARENT    | PARENT    | PROTECTED |
# | ressource 1         | PARENT    | PARENT    | PROTECTED |
#

Company:
  demo1:
    name:         demo 1
    phone:        '0473000000'
    mail:         demo1@example.com
    address_1:    rue exemple
    address_2:    bâtiment B
    address_3:    ''
    zip_code:     '63000'
    town:         Clermont-Ferrand
    presentation:  |
        Cette entreprise est l'entreprise de démonstration pour que tout un chacun puisse avoir un apercu des fonctionnalités
        de l'application entreprise.
        Si vous êtes intéressé par le produit, vous êtes invités à remplir une demande de contact sur le site pro.t-resa.fr

RetailerContract:
  euromaster_garage:
    retailer_id: retailer_euromaster

LinkCompanyCategory:
  demo1_root:
    company_id:   demo1
    category_id:  root
  demo1_coiffeur:
    company_id:   demo1
    category_id:  coiffeur
  demo1_soins:
    company_id:   demo1
    category_id:  soins

Service:
  coupe_1_1:
    company_id:   demo1
    name:         Coupe homme
    service_type: ServiceHairCut
    duration:     15
  coupe_2_1:
    company_id:   demo1
    name:         Coupe femme
    service_type: ServiceHairCut
    duration:     30
  coupe_3_1:
    company_id:   demo1
    name:         Coupe + Couleur
    service_type: ServiceHairCut
    duration:     45

Contract:
  demo1:
    company_id:         demo1
    subscriber_id:      demo
    nb_max_contractors: 3
    nb_max_services:    5
    is_public:          true

ContractProperty:
  demo1_service:
    contract_id: demo1
    property_name: SERVICE
    property_value: ServiceHairCut

CompanyPreferences:
  demo1:
    company_id:   demo1
    is_public:    true
    need_ticket:  false
    calendars_default_visibility:   <?php echo CalendarQuery::PROTECTED_VISIBILITY ?> 
    calendars_default_publication:  <?php echo CalendarQuery::PROTECTED_PUBLICATION ?> 

CompanyVocabulary:
 demo1:
    company_id:   demo1
    contact:      '[-Inf,1]fiche patient|(1,+Inf]fiches patients'
    client:       '[-Inf,1]patient|(1,+Inf]patients'
    assistant:    '[-Inf,1]secrétaire|(1,+Inf]secrétaires'

LinkCompanyAvailableModule:
  demo1_contractors:
    company_id: demo1
    available_module_id:  contractors
  demo1_ressources:
    company_id: demo1
    available_module_id:  ressources
  demo1_admin:
    company_id: demo1
    available_module_id:  admin
  demo1_dashboard:
    company_id: demo1
    available_module_id:  dashboard
  demo1_clients:
    company_id: demo1
    available_module_id:  clients

CompanyDefaultCredential:
  demo1_my_account:
    company_id: demo1
    credential: my_account

  demo1_my_preferences:
    company_id: demo1
    credential: my_preferences

  demo1_my_rights:
    company_id: demo1
    credential: my_rights

  demo1_my_sharing:
    company_id: demo1
    credential: my_sharing

  demo1_my_sharing_admin:
    company_id: demo1
    credential: my_sharing_admin

Contractor:
  demo_demo1:
    user_id:    demo
    company_id: demo1
    entity_type:    <?php echo CompanyEntityPeer::CLASSKEY_CONTRACTOR ?> 
    company_name:   Demo Demo
    agenda_header:  Demo
    public_name:    Dr Demo
    phone:      '0123456789'
    mobile:
    mail:       demo@demo1-company.com
    contacts_default_visibility:    <?php echo ContactQuery::PARENT_VISIBILITY ?> 
    access_contact_company:         <?php echo Contact::RIGHT_MODIFY ?> 
    access_contact_protected:       <?php echo Contact::RIGHT_NONE ?> 
    calendars_default_visibility:   <?php echo CalendarQuery::PARENT_VISIBILITY ?> 
    access_calendar_company:        <?php echo Calendar::RIGHT_VIEW + Calendar::RIGHT_UPDATE + Calendar::RIGHT_CREATE ?> 
    access_calendar_protected:      <?php echo Calendar::RIGHT_VIEW + Calendar::RIGHT_UPDATE + Calendar::RIGHT_CREATE ?> 
    calendars_default_publication:  <?php echo CalendarQuery::PARENT_PUBLICATION ?> 
  collaborateurDemo_demo1:
    user_id:    collaborateurDemo
    company_id: demo1
    entity_type:    <?php echo CompanyEntityPeer::CLASSKEY_CONTRACTOR ?> 
    company_name:   Collaborateur Demo
    agenda_header:  Collaborateur
    public_name:    Dr Collaborateur
    phone:      '0473455678'
    mobile:     '0612457845'
    mail:       collaborateurDemo@demo1-company.com
    contacts_default_visibility: <?php echo ContactQuery::PARENT_VISIBILITY ?> 
    access_contact_company:         <?php echo Contact::RIGHT_MODIFY ?> 
    access_contact_protected:       <?php echo Contact::RIGHT_NONE ?> 
    calendars_default_visibility:   <?php echo CalendarQuery::COMPANY_VISIBILITY ?> 
    access_calendar_company:        <?php echo Calendar::RIGHT_VIEW ?> 
    access_calendar_protected:      <?php echo Calendar::RIGHT_NONE ?> 
    calendars_default_publication:  <?php echo CalendarQuery::COMPANY_PUBLICATION ?> 

Ressource:
  res1_demo1:
    user_id:        null
    company_id:     demo1
    entity_type:    <?php echo CompanyEntityPeer::CLASSKEY_RESSOURCE ?> 
    company_name:   Ressource 1
    agenda_header:  RS_1
    public_name:    fer à friser
    phone:          '0123456789'
    mobile:
    mail:           company@demo1-company.com
  res2_demo1:
    user_id:        null
    company_id:     demo1
    entity_type:    <?php echo CompanyEntityPeer::CLASSKEY_RESSOURCE ?> 
    company_name:   Ressource 2
    agenda_header:  RS_2
    public_name:    bac à couleur
    phone:          '0123456789'
    mobile:
    mail:           company@demo1-company.com

sfGuardProPreferences:
  demo_demo1:
    user_id:    demo
    company_id: demo1
  collaborateurDemo_demo1:
    user_id:    collaborateurDemo
    company_id: demo1

CompanyEntityCredential:
  demo_demo1_admin:
    entity_id:  demo_demo1
    credential: company_admin

Calendar:
  demo_demo1:
    name: Demo (demo1)
  collaborateurDemo_demo1:
    name: Collaborateur
  res2_demo1:
    name: Demo 2 res 1
  res1_demo1:
    name: Demo 1 res 1

LinkCalendarEntity:
  demo_demo1_demo1:
    calendar_id:      demo_demo1
    entity_id:        demo_demo1
    visibility:   <?php echo CalendarQuery::PARENT_VISIBILITY ?> 
    publication:  <?php echo CalendarQuery::PARENT_PUBLICATION ?> 
  collaborateurDemo_demo1_collaborateurDemo_demo1:
    calendar_id:      collaborateurDemo_demo1
    entity_id:        collaborateurDemo_demo1
    visibility:   <?php echo CalendarQuery::PARENT_VISIBILITY ?> 
    publication:  <?php echo CalendarQuery::PARENT_PUBLICATION ?> 
  res2_demo1:
    calendar_id:      res1_demo1
    entity_id:        res1_demo1
    visibility:   <?php echo CalendarQuery::PARENT_VISIBILITY ?> 
    publication:  <?php echo CalendarQuery::PARENT_PUBLICATION ?> 
  res1_demo1:
    calendar_id:      res2_demo1
    entity_id:        res2_demo1
    visibility:   <?php echo CalendarQuery::PARENT_VISIBILITY ?> 
    publication:  <?php echo CalendarQuery::PARENT_PUBLICATION ?> 

FreeBusy:
  business_hour_1_1:
    start_apply_date: <?php echo date('Y-m-d', strtotime('last week')); ?> 
    never_end:        true
    priority:         <?php echo FreeBusyBusinessHour::PRIORITY; ?> 
    state:            <?php echo FreeBusyBusinessHour::STATE; ?> 
    descendant_class: FreeBusyBusinessHour
    accepted_at:      <?php echo time(); ?> 

  business_hour_2_1:
    start_apply_date: <?php echo date('Y-m-d', strtotime('last week')); ?> 
    never_end:        true
    priority:         <?php echo FreeBusyBusinessHour::PRIORITY; ?> 
    state:            <?php echo FreeBusyBusinessHour::STATE; ?> 
    descendant_class: FreeBusyBusinessHour
    accepted_at:      <?php echo time(); ?> 

FreeBusyBusinessHour:
  _business_hour_1_1:
    id:               business_hour_1_1
    start_apply_date: <?php echo date('Y-m-d', strtotime('last week')); ?> 
    never_end:        true
    start_hour:       <?php echo 60*8 ?> 
    end_hour:         <?php echo 60*12 ?> 
    apply_day:        <?php echo chCmsWeekDay::BIN_MONDAY + chCmsWeekDay::BIN_TUESDAY + chCmsWeekDay::BIN_WEDNESDAY + chCmsWeekDay::BIN_THURSDAY + chCmsWeekDay::BIN_FRIDAY ?> 
    accepted_at:      <?php echo time(); ?> 

  _business_hour_2_1:
    id:               business_hour_2_1
    start_apply_date: <?php echo date('Y-m-d', strtotime('last week')); ?> 
    never_end:        true
    start_hour:       <?php echo 60*14 ?> 
    end_hour:         <?php echo 60*19 ?> 
    apply_day:        <?php echo chCmsWeekDay::BIN_MONDAY + chCmsWeekDay::BIN_TUESDAY + chCmsWeekDay::BIN_THURSDAY + chCmsWeekDay::BIN_FRIDAY ?> 
    accepted_at:      <?php echo time(); ?> 


LinkFreeBusyCalendar:
  # company: demo_1
  # contractors
  link_rule_c_1_1_1:
    free_busy_id:     business_hour_1_1
    calendar_id:				demo_demo1
  link_rule_c_1_1_2:
    free_busy_id:     business_hour_1_1
    calendar_id:				collaborateurDemo_demo1
  link_rule_c_2_1_2:
    free_busy_id:     business_hour_2_1
    calendar_id:				collaborateurDemo_demo1
  # ressources
  link_rule_r_1_1_1:
    free_busy_id:     business_hour_1_1
    calendar_id:				res1_demo1
  link_rule_r_1_1_2:
    free_busy_id:     business_hour_1_1
    calendar_id:				res2_demo1
  link_rule_r_2_1_2:
    free_busy_id:     business_hour_2_1
    calendar_id:				res2_demo1
  # holydays

LinkFreeBusyService:
  link_rule_s_1_1_1:
    free_busy_id:     business_hour_1_1
    service_id:       coupe_1_1
  link_rule_s_1_2_1:
    free_busy_id:     business_hour_1_1
    service_id:       coupe_2_1
  link_rule_s_1_3_1:
    free_busy_id:     business_hour_1_1
    service_id:       coupe_3_1
  link_rule_s_2_1_1:
    free_busy_id:     business_hour_2_1
    service_id:       coupe_1_1
  link_rule_s_2_2_1:
    free_busy_id:     business_hour_2_1
    service_id:       coupe_2_1
  link_rule_s_2_3_1:
    free_busy_id:     business_hour_2_1
    service_id:       coupe_3_1


<?php 
  // calculate current date
  $current = time();
  $day = date("j", $current);
  $monday = $day + 1 - date('w', $current);
  $month = date("m", $current);
  $year  = date('Y', $current);
?>
vEvent:
  event1:
    dtstart:      <?php echo date('Y-m-d H:i:s', mktime(8,0,0,$month,$monday,$year)) ?> 
    dtend:        <?php echo date('Y-m-d H:i:s', mktime(8,15,0,$month,$monday,$year)) ?> 
    event_type:   <?php echo EventPeer::CLASSKEY_VEVENT ?> 
    transparency: false
    summary:      test
    description:  a short description for event1
    userowner_id: demo
    company_id:   demo1
    event_class:  <?php echo array_search('COMPANY', Event::$CLASSIFICATIONS) ?> 

Attendee:
  attendee_demo1_event1:
    event_id:         event1
    user_id:          demo
    entity_id:        demo_demo1
    name:             Demo 1
    attendee_role:    <?php echo chCmsRole::REQ_PARTICIPANT ?> 
    attendee_status:  <?php echo chCmsStatus::ACCEPTED ?> 


Contact:
  contact_user2:
    name: user2
    profile_id: user2

ContactCompany:
  user2_demo1:
    company_id: demo1
    id_contact: contact_user2
