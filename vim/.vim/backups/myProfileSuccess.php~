<?php use_helper('JqueryUi', 'I18N'); ?>
<?php include_javascripts_for_form($form) ?>
<?php include_stylesheets_for_form($form) ?>
<script type="text/javascript" charset="utf-8">//<![CDATA[
(function($) {
  $(function(){
    var _selected = $.cookie('profile-tabs') || 0;
    $('#profile-tabs').tabs({
                    'cookie': {'expires': 1, 'name': 'profile-tabs'},
                    'selected': _selected});
  });
})(jQuery)
//]]></script>
<div class="container_12">

<div class="grid_12">
  <form method="POST" action="<?php echo url_for('chCmsFrontendAccount/myProfile') ?>" <?php $form->isMultipart() and print 'enctype="multipart/form-data"' ?>>
    <?php $forms = $form->getEmbeddedForms(); ?>

    <div class="ui-widget ui-widget-content ui-corner-all" id="profile-tabs">

        <ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
          <?php foreach($forms as $key => $subform): ?>
            <?php echo sprintf("<li><a href=\"#%s\">%s</a></li>",$key, __(ucfirst($form->getLabel($key)))); ?>
          <?php endforeach; ?>
          <li class="ui-state-default ui-corner-top">
            <a href="#providers">Authentifications externes</a>
          </li>
        </ul>

        <?php echo $form->renderGlobalErrors(), $form->renderHiddenFields(); ?>

        <?php foreach($forms as $key => $subform): ?>
          <?php if (strlen($help = $form->getHelpText($key))): ?>
            <?php $help = jui_get_info_box($help); ?>
          <?php endif; ?>
          <div id="<?php echo $key ?>">
            <div class=".form-input-help">
              <?php echo $help ?>
            </div>

            <table>
              <?php echo $subform->render(); ?>
            </table>

            <p class="action-buttons">
              <?php echo jui_button_link('Back to my dashboard', 'chCmsFrontendAccount/index', 'icon=home'); ?>
              <?php echo jui_submit_button('Save'); ?>
            </p>
          </div>
        <?php endforeach; ?>



      <div id="providers" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide">
      <?php open_backend_list_table() ?>
        <?php include_backend_list_header(array(
            'Compte Externe',
            '',
            array('text' => '', 'attributes' => 'actions=true'))) ?>
        <tbody>
          <?php foreach($providers as $provider): ?>
             <?php open_backend_list_row(); ?>
              <td><?php echo jui_icon($provider->getIcon(32)) ?></td>
              <td><?php echo $provider->getAccountIdentifier() ?></td>

            <?php open_backend_list_action_cell() ?>
              <?php
             $can_delete_provider = !(count($providers) == 1 AND $user->hasDummyPassword());
              if ($can_delete_provider) {
              echo jui_button_link('Annuler', 'associate_delete', $provider, array(
                              'icon' => 'silk-delete',
                              'confirm' => __('Are you sure ?')));
              }
              ?>
          </td>
          </tr>
          <?php endforeach; ?>
          <?php if((count($providers) == 0)): ?>

             <?php open_backend_list_row(); ?>
             <td></td>
             <td>Aucun compte externe</td>
             <td></td>
             </tr>
          <?php endif;?>
        </tbody>
      </table>

          <br/>
          <h4>Ajouter un fournisseur</h4>

          <p>
            <?php include_partial('chCmsFrontendAccount/externalAuthentications'); ?>
          </p>
        </div><!-- end provider-->


      </div><!--end ui-tabs ui-widget-->

    </form><!--end form-->

  </div><!-- end grid12-->

  <div class="clear"></div>

</div><!-- end container12-->

<?php slot('title') ?>
 <h3>Mon Compte</h3>
<?php end_slot() ?>
<?php
// vim:ft=php.html.sftemplate
?>
