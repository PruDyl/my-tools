(function($) {
  $(function(){
    var currentRequest;
    $.widget('ui.simplecarAutoComplete', {
      options: {
        url: $.ExposeRouting.generate('chcms_cars_autocomplete', {}),
        minLength: 3
      },
      _create: function(){
        var self = this;
        this.element.autocomplete({
            source: this.options.url,
            minLength: this.options.minLength,
            select: function(event, ui){return self._select(self, event, ui)}
          })
          .data('autocomplete')
            ._renderItem = this._renderItem;
      },
      _setOption: function( key, value ) {
        $.Widget.prototype._setOption.apply( this, arguments );
        if(value){
          this.element.autocomplete('option', key, value);
        }
      },
      _select: function( self, event, ui ) {
        if(ui.item){
          self.element
                .val(ui.item.result);
        }
      },
      _renderItem: function(ul, item){
        return $('<li />')
                .data("item.autocomplete", item)
                .append($('<a />').html(item.result))
                .appendTo(ul);
      }
    });
	});
})(jQuery);

