<?php
/**
 * @package    T-resa-lib
 * @subpackage  default
 * @author     Julien Muetton <julien_muetton@carpe-hora.com>
 * @copyright  (c) Carpe Hora SARL 2011
 */

/**
 * Company form.
 *
 * @package    T-resa-lib
 * @subpackage form
 * @author     Julien Muetton <julien_muetton@carpe-hora.com>
 * @version    SVN: $Id: sfPropelFormTemplate.php 10377 2008-07-21 07:10:32Z dwhittle $
 */
class CompanyForm extends BaseCompanyForm
{
  public function configure()
  {
    unset($this['slug']);
    unset($this['latitude']);
    unset($this['longitude']);
    unset($this['created_at']);
    unset($this['updated_at']);
    unset($this['logo']);

    $this->widgetSchema['presentation'] = new chCmsWidgetRichText(array(
      'width'  => 550,
      'height' => 350,
      'config' => 'theme_advanced_disable: "anchor,cleanup,help"',
    ));

    $this->setWidget('upgrade_zip_town_autocomplete', new chCmsFormWidgetUpgradeZipTown(array(
      'zipcode' => 'zip_code',
      'town'    => 'town',
    )));

    $this->setValidator('id', new sfValidatorNumber());
    $this->setValidator('latitude', new sfValidatorPass());
    $this->setValidator('longitude', new sfValidatorPass());
    $this->setValidator('name', new sfValidatorString(array(
                              'required' => true
                        ),array(
                              'required' => 'Ce champ est obligatoire'
                        )));
    $this->setValidator('phone', new chCmsValidatorPhone(array(
                              'required' => true
                        ),array(
                              'invalid'=>'"%value%" n\'est pas un numéro de téléphone',
                              'required' => 'Ce champ est obligatoire'
                        )));
    $this->setValidator('mail', new sfValidatorEmail(array(
                            'required'   => true,
                            'max_length' => '255'
                      ),array(
                            'invalid'    => '"%value%" n\'est pas une adresse de courier electronique',
                            'max_length' => 'Vous ne pouvez avoir une adresse mail de plus de %max_length% caractères',
                            'required' => 'Ce champ est obligatoire'
                      )));
    $this->setValidator('address_1', new chCmsValidatorFrSentence(array(
                            'required'  => true,
                            'max_length' => '255'
                      ),array(
                            'invalid'     => 'Ce champ ne peut pas contenir de caractères spéciaux !',
                            'max_length' => 'Ce champ ne peut dépasser %max_length% caractères', 
                            'required' => 'Ce champ est obligatoire'
                      )));
    $this->setValidator('address_2', new chCmsValidatorFrSentence(array(
                            'required'  => false,
                            'max_length' => '255'
                      ),array(
                            'invalid'     => 'Ce champ ne peut pas contenir de caractères spéciaux !',
                            'max_length' => 'Ce champ ne peut dépasser %max_length% caractères'
                      )));
    $this->setValidator('address_3', new chCmsValidatorFrSentence(array(
                            'required'  => false,
                            'max_length' => '255'
                      ),array(
                            'invalid'     => 'Ce champ ne peut pas contenir de caractères spéciaux !',
                            'max_length' => 'Ce champ ne peut dépasser %max_length% caractères'
                      )));
    $this->setValidator('zip_code', new sfValidatorRegex(array(
                            'required'  => true,
                            'pattern' => '#^\d{5}$#'
                      ),array(
                            'invalid' => 'Un code postal est composé de 5 chiffres',
                            'required' => 'Ce champ est obligatoire'
                      )));
    $this->setValidator('town', new chCmsValidatorFrSentence(array(
                            'required'  => true,
                            'max_length' => '255'
                      ),array(
                            'invalid' => 'Une ville ne contient pas de caractères spéciaux !',
                            'max_length' => 'Ce champ ne peut dépasser %max_length% caractères',
                            'required' => 'Ce champ est obligatoire'
                      )));
    $this->setValidator('presentation', new chCmsValidatorHTML());

    $this->validatorSchema->setPostValidator(new chCmsValidatorUpgradeZipTown(array(
      'zipcode' => 'zip_code',
      'town'    => 'town',
      'check_consistancy' => false
    )));

    $this->widgetSchema->setLabels(array(
      'name'          => 'Nom de l\'entreprise',
      'phone'         => 'Numéro de téléphone',
      'mail'          => 'adresse mail',
      'address_1'     => 'Adresse',
      'address_2'     => 'Bâtiment',
      'address_3'     => 'Champ complémentaire',
      'zip_code'      => 'Code postal',
      'town'          => 'Ville',
      'presentation'  => 'Présentation de l\'entreprise'
    ));

    $this->widgetSchema->setNameFormat('company[%s]');

    chTools::setFormFormatter($this);
  }

}
