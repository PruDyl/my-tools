<?php
/**
 * This file declare the BaseCredentialForm class.
 *
 * @package chCmsAdminContractorPlugin
 * @subpackage form
 * @author Julien Muetton <julien_muetton@carpe-hora.com>
 * @copyright (c) Carpe Hora SARL 2011
 * @since 2011-01-07
 */

/**
 * the base form for credential forms
 */
class BaseCredentialForm extends BaseForm
{
  /**
   * return the list of all the available admin permissions
   *
   * @return void
   * @author Julien Muetton <julien_muetton@carpe-hora.com>
   **/
  public function getAdminPermissionList()
  {
    return AdminMenu::getInstance()->getAllCredentials();
  }

  /**
   * undocumented function
   *
   * @return void
   * @author Ludovic Pell√© <ludovic_pelle@carpe-hora.com>
   **/
  public function getAdminPermissionListSortedByGroup()
  {
          $credentials_array = $this->getAdminPermissionList();

          $cred_groups = array();
          
          foreach ($credentials_array as $id => $cred)
          {
            if (!array_key_exists($cred['group_name'], $cred_groups) && $cred['group_name']!= null)
            {
              $cred_groups[$cred['group_name']]= array();
            }
          
            if ($cred['group_name']=== null)
            {
              $cred['group_name']='Autres';
            }
      
            $cred_groups[$cred['group_name']][$id] = $cred;
          }
          krsort($cred_groups);
     return $cred_groups;
  }
  /**
   * return the currently selected company
   *
   * @return Company
   * @author Julien Muetton <julien_muetton@carpe-hora.com>
   **/
  public function getCompany()
  {
    return $this->getUser()->getSelectedCompany();
  }
} // END OF BaseCredentialForm
