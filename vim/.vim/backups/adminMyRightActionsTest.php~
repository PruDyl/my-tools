<?php

$app = 'pro';

include(dirname(__FILE__).'/../../../../test/bootstrap/functional.php');

$browser = TresaTestFunctional::initialize(); 

$browser
->info("Test not Logged")
->get('/admin/mon-compte/rights')

    //check routing is OK
    ->with('request')->begin()
      ->isMethod('get')
      ->isParameter('module', 'admin')
      ->isParameter('action', 'index')
    ->end()
    
    // check the response
    ->with('response')->begin()
      ->isStatusCode(401)
      ->isValid()
      ->checkForm(new chCmsFormSignin())
    ->end()
    // end of get /admin/mon-compte/rights
  // end of block check when not logged in
  
  ->signin('demo', 'demo')

  ->info("display right")
    ->get('/admin/mon-compte/rights')
    
    //check routing is OK
    ->with('request')->begin()
      ->isMethod('get')
      ->isParameter('module', 'admin')
      ->isParameter('action', 'index')
    ->end()
    
    // check the response
    ->with('response')->begin()
      ->isStatusCode(200)
      ->isValid()
    ->end()

//Test by click
  ->get('/my')
  ->info("click on admininistration > Account > rights")
    ->click('administration')
    ->with('response')->begin()
      ->contains('Mon compte')
    ->end() // end on response block

    ->click('Mon compte')
    ->with('response')->begin()
      ->contains('Mes droits')
    ->end() // end on response block
    ->click('Mes Droits')

    
    //check routing is OK
    ->with('request')->begin()
      ->isMethod('get')
      ->isParameter('module', 'admin')
      ->isParameter('action', 'index')
    ->end()
    
    // check the response
    ->with('response')->begin()
      ->isStatusCode(200)
      ->isValid()
    ->end()
    ;
    // end of get /admin/mon-compte/rights
  // end of block display account right
