<?php
/**
 * @package    T-resa-lib
 * @subpackage  default
 * @author     Julien Muetton <julien_muetton@carpe-hora.com>
 * @copyright  (c) Carpe Hora SARL 2011
 */

/**
 * CompanyEntityExtraFormField form.
 *
 * @package    T-resa-lib
 * @subpackage form
 * @author     Julien Muetton <julien_muetton@carpe-hora.com>
 */
class CompanyEntityExtraFormFieldForm extends BaseCompanyEntityExtraFormFieldForm
{
  public static function getReadableTypeFor($field)
  {
    $a = self::getFieldTypesChoices();
    return $a[$field->getFieldType()];
  }

  public static function getFieldTypesChoices()
  {
    return array(
        1 => 'Numéro de téléphone',
        2 => 'Adresse mail',
        3 => 'Numéro de sécurité sociale',
        4 => 'Numéro de passeport',
        5 => 'Numéro de permis de conduire',
        6 => 'Numéro de carte d\'identité',
        7 => 'Texte court',
        8 => 'Texte long',
        9 => 'Texte formatté'
      );
  }

  public function configure()
  {
    unset(
      $this['company_id'],
      $this['sortable_rank']);

    $choices = self::getFieldTypesChoices();

    $this->setWidget('field_type', new sfWidgetFormChoice(array(
      'choices' => $choices
    )));

    $this->setValidator('field_type', new sfValidatorChoice(array('choices' => array_keys($choices))));

    $this->widgetSchema->setLabels(array(
      'field_help' => 'Description du champ',
      'field_type' => 'Type de champ',
      'field_label' => 'Libellé',
      'is_public' => 'Publié sur le compte'
    ));

    $this->widgetSchema->setHelps(array(
      'field_help' => 'L\'aide contextuelle apparaissant dans le formulaire pour ce champ',
      'field_type' => 'Le type de champ à remplir',
      'field_label' => 'Le nom du champ apparaîssant dans le formulaire',
      'is_public' => 'l\'utilisateur aura un accès à ce champ dans son compte'
    ));

  }

  public function doSave($con = null)
  {
    $this->getObject()->setCompanyId($this->getUser()->getSelectedCompany()->getId());
    return parent::doSave($con);
  }
}
