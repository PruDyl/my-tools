<?php
/**
 * This file declare the chCmsApplicationFilter class.
 *
 * @package chCmsApplicationPlugin
 * @subpackage Filter
 * @author Julien Muetton <julien_muetton@carpe-hora.com>
 * @copyright (c) Carpe Hora SARL 2010
 * @since 2010-12-16
 */

/**
 * the application filter, to add the assets
 */
class chCmsApplicationFilter extends sfFilter
{
  public function execute($filterChain)
  {
    //load the css and javascript
    $this->addScripts();
    $this->addMeta();

    $filterChain->execute();
  }

  /**
   * add assets to the response
   * @return void
   */
  public function addScripts()
  {
    $layoutVersion = '1.3.0.rc29.12';
    $response = $this->getContext()->getResponse();
    $theme = $this->getContext()->getUser()->getTheme();

    $response->addStylesheet('/chCmsApplicationPlugin/css/layout-default-'.$layoutVersion.'.css', sfWebResponse::MIDDLE);
    $response->addStylesheet('/chCmsApplicationPlugin/css/themes/'.$theme.'/jquery.layout.css', sfWebResponse::MIDDLE);

    $response->addStylesheet('/chCmsApplicationPlugin/css/menu.css', sfWebResponse::MIDDLE);
    $response->addStylesheet('/chCmsApplicationPlugin/css/themes/'.$theme.'/menu.css', sfWebResponse::MIDDLE);

    if (sfConfig::get('sf_debug', false))
    {
      $response->addJavaScript('/chCmsApplicationPlugin/js/debug/jquery.layout-'.$layoutVersion.'.js');
    }
    else
    {
      $response->addJavaScript('/chCmsApplicationPlugin/js/jquery.layout.min-'.$layoutVersion.'.js');
    }
      $response->addJavaScript('/chCmsApplicationPlugin/js/adminmenu.js', sfWebResponse::LAST);
  }

  /**
   * adds meta keys for applications
   *
   * @return void
   * @author Julien Muetton <julien_muetton@carpe-hora.com>
   **/
  protected function addMeta()
  {
    $response = $this->getContext()->getResponse();
    /*
    $response->addMeta('apple-mobile-web-app-capable', 'yes');
    $response->addMeta('apple-mobile-web-app-status-bar-style', 'black');
    $response->addMeta('apple-touch-fullscreen', 'YES');
    $response->addMeta('viewport', 'width=320;initial-scale=1;;minimum-scale=0.6666; maximun-scale=1.0;');
    */
  }
} // END OF chCmsApplicationFilter
