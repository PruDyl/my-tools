<?php
/**
 * This file declare the sfGuardMessageManager class.
 *
 * @package chCmsMessageNotifier
 * @subpackage notifier
 * @author Ludovic Pellé <ludovic_pelle@carpe-hora.com>
 * @copyright (c) Carpe Hora SARL 2011
 * @since 2011-07-18
 */

/**
 * This Manager enable to  sendMessage to guardUser
 * This is an example to use NotifierPlugin :
 * step 1: get the context on loadFactoriesEvent
 * step 2: launch *subject*.notify event and notifiers  ll send.
 *
 */
abstract class sfGuardMessageManager
{
  protected static $context;

  /**
   * undocumented function
   *
   * @return void
   * @author Ludovic Pellé <ludovic_pelle@carpe-hora.com>
   **/
  public static function listenToLoadFactoriesEvent(sfEvent $event)
  {
    self::$context = $event->getSubject();
  }
 /**
  * notify a meesage to guardUser
  * @see BasechCmsMessageNotifier listener
  *
  * @return void
  * @author Ludovic Pellé <ludovic_pelle@carpe-hora.com>
  **/
  public static function sendMessage($guardUser, $partial, $params)
  {
    $dispatcher = self::$context->getEventDispatcher();

    $event = $dispatcher->notifyUntil(new sfEvent($guardUser,'guard_user.notify', array('partial' => $partial,
                                                                       'params' => $params)));
    if (!$event->isProcessed())
    {
      throw new LogicException('no one do something on this!');
    }
  }

  // your class code here
} // END OF sfGuardMessageManager


