<?php
/**
 * This file declare the PluginAssociateForm class.
 *
 * @package chCmsGuardExtraPlugin
 * @subpackage lib
 * @author Camille NERON <camille_neron@carpe-hora.com>
 * @copyright (c) Carpe Hora SARL 2011
 * @since 2011-01-19
 */

/**
 * declaration of form Associate which allow to
 * associate a username T-Resa with a username provider
 */
class PluginAssociateForm extends BasesfGuardUserForm
{
  protected $guardUser;

  /**
   * declare PluginAssociateForm
   *
   * @return void
   * @author Camille NERON <camille_neron@carpe-hora.com>
   **/
  public function configure()
  {
    $this->useFields(array(
        'username', 'password'
        ));

    $this->setWidgets(array(
      'username' => new sfWidgetFormInput(),
      'password' => new sfWidgetFormInput(array('type' => 'password')),
    ));

    // labels
    $this->widgetSchema->setLabels(array(
      'username' => 'Pseudo',
    ));

    $this->validatorSchema->setPostValidator(new sfGuardValidatorUser());
    $this->widgetSchema->setNameFormat('associate[%s]');
  }

  public function getsfGuardUser()
  {
    if (!$this->guardUser AND !empty($this->values['this->guardUsername']))
    {
      $this->guardUser = sfGuardUserQuery::create()->findOneByUsername($this->values['this->guardUsername']);
    }

    return $this->guardUser;
  }
} // END OF PluginAssociateForm
