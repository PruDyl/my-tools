<?php
/**
 * @package    T-resa-lib
 * @subpackage  default
 * @author     Julien Muetton <julien_muetton@carpe-hora.com>
 * @copyright  (c) Carpe Hora SARL 2011
 */
class sfGuardUserPinCodeForm extends BasesfGuardUserPinCodeForm
{
  public function configure()
  {
    unset($this['user_id'], $this['id']);
    $this->widgetSchema->setLabels(array(
      'activated' => 'Protection activée',
      'password' => 'Clé t-resa'
    ));

    $this->widgetSchema->setHelps(array(
      'password' => 'Votre clé t-resa à fournir aux prestataires pour activer votre compte.<br />Ce code est un <strong>code public</strong> dans le sens où vous devrez le fournir à vos prestataires, utilisez quelque chose de <strong>facile à retenir</strong> comme votre année de naissance, votre plaque d\'imatriculation ou encore le prénom de votre enfant, mais <strong>en aucun cas un code confidentiel tel que votre code de carte bleue ou votre mot de passe !</strong>'
    ));
    $this->widgetSchema->setNameFormat('pin_code[%s]');
    chTools::setFormFormatter($this);
  }

  public function save($con = null)
  {
    $con = !is_null($con) ? $con : Propel::getConnection(sfGuardUserPeer::DATABASE_NAME);
    $con->beginTransaction();
    try
    {
      parent::save($con);
      $con->commit();
    }
    catch(Exception $e)
    {
      $con->rollBack();
      throw $e;
    }
  }
}
